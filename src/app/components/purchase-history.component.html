<div class="history-container">
  <div class="history-header">
    <div class="header-content">
      <h1 class="main-title">
        <span class="title-icon">ğŸ“‹</span>
        Mis Compras
      </h1>
      <p class="subtitle">Historial completo de tus compras y keys de activaciÃ³n</p>
    </div>
    <div class="header-decoration"></div>
  </div>

  <!-- EstadÃ­sticas del Usuario -->
  <div class="stats-section" *ngIf="!isLoading && orders.length > 0">
    <h2 class="section-title">
      <span class="title-icon">ğŸ“Š</span>
      Resumen de Actividad
    </h2>
    <div class="stats-grid">
      <div class="stat-card purchases-card">
        <div class="stat-icon">ğŸ“¦</div>
        <div class="stat-content">
          <div class="stat-value">{{ userStats.totalOrders }}</div>
          <div class="stat-label">Compras Realizadas</div>
        </div>
      </div>
      <div class="stat-card spending-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-content">
          <div class="stat-value">${{ getTotalSpent() }}</div>
          <div class="stat-label">Total Invertido</div>
        </div>
      </div>
      <div class="stat-card games-card">
        <div class="stat-icon">ğŸ®</div>
        <div class="stat-content">
          <div class="stat-value">{{ userStats.totalGames }}</div>
          <div class="stat-label">Juegos en Biblioteca</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-section" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>â³ Cargando tu biblioteca de juegos...</p>
  </div>

  <!-- Lista de Ã“rdenes -->
  <div class="orders-section" *ngIf="!isLoading && orders.length > 0">
    <h2 class="section-title">
      <span class="title-icon">ğŸ¯</span>
      Historial de Ã“rdenes
    </h2>
    
    <div class="orders-list">
      <div class="order-card" *ngFor="let order of orders; trackBy: trackByOrderId">
        <!-- Header de la Orden -->
        <div class="order-header">
          <div class="order-main-info">
            <div class="order-identity">
              <div class="order-number">
                <span class="order-icon">ğŸ§¾</span>
                {{ order.orderNumber }}
              </div>
              <div class="order-date">{{ formatDate(order.purchaseDate) }}</div>
            </div>
            <div class="order-status-section">
              <span class="order-status" [class]="getStatusClass(order.status)">
                <span class="status-icon">{{ getStatusIcon(order.status) }}</span>
                {{ getStatusText(order.status) }}
              </span>
            </div>
          </div>
          <div class="order-amount">
            <div class="amount-label">Total Pagado</div>
            <div class="amount-value">${{ getOrderTotal(order) }}</div>
          </div>
        </div>

        <!-- Contenido de la Orden -->
        <div class="order-body">
          <!-- Items de la Orden -->
          <div class="games-section">
            <h4 class="subsection-title">
              <span class="subsection-icon">ğŸ®</span>
              Juegos Adquiridos
            </h4>
            <div class="games-grid">
              <div class="game-item" *ngFor="let item of order.items">
                <div class="game-info">
                  <div class="game-title">{{ item.gameTitle }}</div>
                  <div class="game-details">
                    <span class="detail-badge">
                      <span class="badge-icon">ğŸ“Š</span>
                      {{ item.quantity }}x
                    </span>
                    <span class="detail-badge">
                      <span class="badge-icon">ğŸ’°</span>
                      ${{ getItemPrice(item) }}
                    </span>
                    <span class="detail-badge total-badge">
                      <span class="badge-icon">ğŸ·ï¸</span>
                      ${{ getItemTotal(item) }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- SecciÃ³n de Keys -->
          <div class="keys-section">
            <div class="keys-header">
              <h4 class="subsection-title">
                <span class="subsection-icon">ğŸ”‘</span>
                Keys de ActivaciÃ³n
              </h4>
              <button 
                class="btn-resend" 
                (click)="resendKeys(order.orderNumber)"
                title="Reenviar keys por correo electrÃ³nico"
              >
                <span class="btn-icon">ğŸ“§</span>
                Reenviar
              </button>
            </div>

            <div class="keys-container">
              <div class="key-card" *ngFor="let key of getOrderKeys(order.orderNumber)">
                <div class="key-header">
                  <div class="key-game-info">
                    <div class="key-game-title">{{ key.gameTitle }}</div>
                    <div class="key-platform">
                      <span class="platform-icon">ğŸ®</span>
                      {{ key.activationPlatform }}
                    </div>
                  </div>
                  <div class="key-status">
                    <span class="status-badge" [class]="key.isUsed ? 'used' : 'available'">
                      {{ key.isUsed ? 'âœ… Activada' : 'ğŸ”‘ Disponible' }}
                    </span>
                  </div>
                </div>
                
                <div class="key-body">
                  <div 
                    class="key-code-display" 
                    (click)="copyKeyToClipboard(key.key)"
                    title="Click para copiar al portapapeles"
                  >
                    <div class="key-code">{{ key.key }}</div>
                    <div class="copy-hint">ğŸ“‹ Click para copiar</div>
                  </div>
                  
                  <div class="key-metadata">
                    <div class="metadata-item">
                      <span class="metadata-icon">ğŸ“…</span>
                      <span>{{ formatDate(key.purchaseDate) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="activation-help">
              <div class="help-icon">ğŸ’¡</div>
              <div class="help-content">
                <h5>Instrucciones de ActivaciÃ³n</h5>
                <ol>
                  <li>Abre Steam y ve a "Juegos" â†’ "Activar un producto en Steam"</li>
                  <li>Acepta el acuerdo de licencia de Steam</li>
                  <li>Copia y pega la key exactamente como aparece</li>
                  <li>Â¡Disfruta tu juego!</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Historial VacÃ­o -->
  <div class="empty-section" *ngIf="!isLoading && orders.length === 0">
    <div class="empty-content">
      <div class="empty-icon">ğŸ›’</div>
      <h2 class="empty-title">Tu biblioteca estÃ¡ vacÃ­a</h2>
      <p class="empty-message">Cuando realices tu primera compra, tus juegos y keys aparecerÃ¡n aquÃ­</p>
      <div class="empty-features">
        <div class="feature-item">
          <span class="feature-icon">âš¡</span>
          <span>ActivaciÃ³n instantÃ¡nea</span>
        </div>
        <div class="feature-item">
          <span class="feature-icon">ğŸ“§</span>
          <span>Keys por correo</span>
        </div>
        <div class="feature-item">
          <span class="feature-icon">ğŸ”’</span>
          <span>Compras seguras</span>
        </div>
      </div>
      <a routerLink="/games" class="btn-explore">
        <span class="btn-icon">ğŸ®</span>
        Explorar Juegos
      </a>
    </div>
  </div>
</div>